<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esempio Uso cercaSocietaDaCodice.js</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .input-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            min-height: 50px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .code {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .society-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .society-info h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ Demo: Ricerca Societ√† in Firestore</h1>
        <p>Questo esempio dimostra come utilizzare <code>cercaSocietaDaCodice.js</code> per cercare societ√† nel database Firestore.</p>
        
        <div class="input-group">
            <label for="codice-societa">Codice Societ√†:</label>
            <input type="text" id="codice-societa" placeholder="Inserisci il codice societ√† (es. ABC123)" value="">
        </div>
        
        <div>
            <button onclick="cercaSocieta()">üîç Cerca Societ√†</button>
            <button onclick="cercaAvanzata()">üîç Ricerca Avanzata</button>
            <button onclick="eseguiEsempi()">‚ñ∂Ô∏è Esegui Esempi</button>
            <button onclick="pulisciRisultati()">üóëÔ∏è Pulisci</button>
        </div>
        
        <div id="risultato" class="result info" style="display: none;">
            <h3>Risultato:</h3>
            <div id="contenuto-risultato"></div>
        </div>
        
        <div class="info">
            <h3>üìã Istruzioni per l'uso:</h3>
            <ol>
                <li><strong>Configura Firebase:</strong> Modifica il file <code>cercaSocietaDaCodice.js</code> inserendo la tua configurazione Firebase reale.</li>
                <li><strong>Struttura Dati:</strong> Assicurati che la collection "societa" contenga documenti con la struttura:
                    <div class="code">{
  "codici": "ABC123",
  "nome": "Nome Societ√†",
  "config": { /* configurazioni */ },
  "giocatori": [ /* array giocatori */ ],
  "attiva": true
}</div>
                </li>
                <li><strong>Test:</strong> Inserisci un codice societ√† esistente e prova la ricerca.</li>
            </ol>
        </div>
        
        <div class="info">
            <h3>üõ†Ô∏è Funzioni Disponibili:</h3>
            <ul>
                <li><code>cercaSocietaDaCodice(codice)</code> - Ricerca diretta per codice</li>
                <li><code>cercaSocietaAvanzata(codice, opzioni)</code> - Ricerca con opzioni avanzate</li>
                <li><code>esempiUtilizzo()</code> - Esegue esempi di utilizzo</li>
                <li><code>verificaAccessoSocieta(codice)</code> - Verifica accesso per codice</li>
            </ul>
        </div>
    </div>

    <!-- Caricamento del modulo cercaSocietaDaCodice.js -->
    <script type="module">
        // Importa le funzioni dal modulo
        let cercaSocietaDaCodice, cercaSocietaAvanzata, esempiUtilizzo, verificaAccessoSocieta;
        
        try {
            // Carica il modulo
            const module = await import('./cercaSocietaDaCodice.js');
            
            // Assegna le funzioni importate
            cercaSocietaDaCodice = module.cercaSocietaDaCodice;
            cercaSocietaAvanzata = module.cercaSocietaAvanzata;
            esempiUtilizzo = module.esempiUtilizzo;
            verificaAccessoSocieta = module.verificaAccessoSocieta;
            
            console.log('‚úÖ Modulo cercaSocietaDaCodice.js caricato correttamente');
            
            // Rendi le funzioni globali per l'uso dai pulsanti HTML
            window.cercaSocietaDaCodiceFn = cercaSocietaDaCodice;
            window.cercaSocietaAvanzataFn = cercaSocietaAvanzata;
            window.esempiUtilizzoFn = esempiUtilizzo;
            window.verificaAccessoSocietaFn = verificaAccessoSocieta;
            
            // Esporre le funzioni direttamente per debugging da console F12
            // (sia con nome originale che con compatibilit√†)
            window.cercaSocietaDaCodice = cercaSocietaDaCodice;
            window.cercaSocietaAvanzata = cercaSocietaAvanzata;
            window.esempiUtilizzo = esempiUtilizzo;
            window.verificaAccessoSocieta = verificaAccessoSocieta;
            
            console.log('üõ†Ô∏è Funzioni esposte globalmente per debugging:');
            console.log('  - window.cercaSocietaDaCodice(codice)');
            console.log('  - window.cercaSocietaDaCodiceFn(codice) [alias per compatibilit√†]');
            console.log('  - window.cercaSocietaAvanzata(codice, opzioni)');
            console.log('  - window.esempiUtilizzo()');
            console.log('  - window.verificaAccessoSocieta(codice)');
            
        } catch (error) {
            console.error('‚ùå Errore nel caricamento del modulo:', error);
            
            // Create fallback functions that simulate the API but work without Firebase
            window.cercaSocietaDaCodiceFn = async function(codice) {
                // Demo data for testing
                const demoSocieta = {
                    "ABC123": {
                        id: "demo-abc123",
                        nome: "Societ√† Demo ABC",
                        codici: "ABC123",
                        config: { tema: "light", notifiche: true },
                        giocatori: ["1 ROSSI MARIO", "2 BIANCHI LUIGI", "3 VERDI GIUSEPPE"],
                        attiva: true,
                        dataCreazione: "2024-01-01"
                    },
                    "XYZ789": {
                        id: "demo-xyz789",
                        nome: "Societ√† Demo XYZ",
                        codici: "XYZ789",
                        config: { tema: "dark" },
                        giocatori: ["10 NERI ANTONIO", "11 GIALLI FRANCESCO"],
                        attiva: false,  // Inactive for testing
                        dataCreazione: "2024-01-15"
                    },
                    "DEMO": {
                        id: "demo-demo",
                        nome: "Societ√† Dimostrativa",
                        codici: "DEMO",
                        config: { tema: "light", notifiche: true, demo: true },
                        giocatori: ["1 DEMO MARIO", "2 TEST LUIGI", "3 EXAMPLE GIUSEPPE", "4 SAMPLE ANTONIO"],
                        attiva: true,
                        dataCreazione: "2024-01-01"
                    }
                };
                
                const normalizedCode = codice.trim().toUpperCase();
                return demoSocieta[normalizedCode] || null;
            };
            
            window.cercaSocietaAvanzataFn = async function(codice, opzioni = {}) {
                const societa = await window.cercaSocietaDaCodiceFn(codice);
                if (!societa) return null;
                
                // Apply filters
                const { soloAttive = true } = opzioni;
                if (soloAttive && societa.attiva === false) {
                    return [];
                }
                
                return [societa];
            };
            
            window.esempiUtilizzoFn = async function() {
                console.log('=== ESEMPI DI UTILIZZO (MODALIT√Ä DEMO) ===');
                console.log('Funzioni Firebase non disponibili, usando dati demo.');
                console.log('Codici societ√† disponibili: ABC123, XYZ789 (inattiva), DEMO');
            };
            
            window.verificaAccessoSocietaFn = async function(codice) {
                const societa = await window.cercaSocietaDaCodiceFn(codice);
                return societa && societa.attiva;
            };
            
            // Also expose with original names for console compatibility
            window.cercaSocietaDaCodice = window.cercaSocietaDaCodiceFn;
            window.cercaSocietaAvanzata = window.cercaSocietaAvanzataFn;
            window.esempiUtilizzo = window.esempiUtilizzoFn;
            window.verificaAccessoSocieta = window.verificaAccessoSocietaFn;
            
            console.log('‚úÖ Modalit√† demo attivata - Firebase non disponibile');
            console.log('üõ†Ô∏è Funzioni demo esposte globalmente:');
            console.log('  - window.cercaSocietaDaCodice(codice)');
            console.log('  - window.cercaSocietaDaCodiceFn(codice) [alias per compatibilit√†]');
            console.log('  - window.cercaSocietaAvanzata(codice, opzioni)');
            console.log('  - window.esempiUtilizzo()');
            console.log('  - window.verificaAccessoSocieta(codice)');
            console.log('üìä Codici di test disponibili: ABC123, XYZ789 (inattiva), DEMO');
            
            mostraRisultato(`‚ö†Ô∏è Modalit√† demo attivata - Firebase non disponibile. Sono disponibili i seguenti codici di test: <strong>ABC123</strong>, <strong>XYZ789</strong> (inattiva), <strong>DEMO</strong>`, 'info');
        }
        
        // Funzioni per l'interfaccia utente
        window.cercaSocieta = async function() {
            const codice = document.getElementById('codice-societa').value.trim();
            
            if (!codice) {
                mostraRisultato('Inserisci un codice societ√† valido', 'error');
                return;
            }
            
            if (!window.cercaSocietaDaCodiceFn) {
                mostraRisultato('Modulo non ancora caricato, riprova tra un momento', 'error');
                return;
            }
            
            try {
                mostraRisultato('üîç Ricerca in corso...', 'info');
                
                const societa = await window.cercaSocietaDaCodiceFn(codice);
                
                if (societa) {
                    // Check if company is active
                    if (societa.attiva === false) {
                        mostraRisultato(`‚ùå Societ√† trovata ma non attiva: ${societa.nome || codice}`, 'error');
                        return;
                    }
                    
                    const html = `
                        <div class="society-info">
                            <h4>‚úÖ Societ√† Trovata</h4>
                            <p><strong>Nome:</strong> ${societa.nome}</p>
                            <p><strong>Codice:</strong> ${societa.codici}</p>
                            <p><strong>ID Documento:</strong> ${societa.id}</p>
                            <p><strong>Giocatori:</strong> ${societa.giocatori.length}</p>
                            <p><strong>Configurazioni:</strong> ${Object.keys(societa.config).length}</p>
                            <p><strong>Attiva:</strong> ${societa.attiva ? '‚úÖ S√¨' : '‚ùå No'}</p>
                            ${societa.dataCreazione ? `<p><strong>Data Creazione:</strong> ${societa.dataCreazione}</p>` : ''}
                        </div>
                    `;
                    mostraRisultato(html, 'success');
                } else {
                    mostraRisultato(`‚ùå Codice societ√† non valido: ${codice}`, 'error');
                }
                
            } catch (error) {
                console.error('Errore nella ricerca:', error);
                mostraRisultato(`‚ùå Errore durante la ricerca: ${error.message}`, 'error');
            }
        };
        
        window.cercaAvanzata = async function() {
            const codice = document.getElementById('codice-societa').value.trim();
            
            if (!codice) {
                mostraRisultato('Inserisci un codice societ√† per la ricerca avanzata', 'error');
                return;
            }
            
            if (!window.cercaSocietaAvanzataFn) {
                mostraRisultato('Modulo non ancora caricato, riprova tra un momento', 'error');
                return;
            }
            
            try {
                mostraRisultato('üîç Ricerca avanzata in corso...', 'info');
                
                const opzioni = {
                    ricercaParziale: true,
                    soloAttive: true,
                    limite: 10
                };
                
                const societa = await window.cercaSocietaAvanzataFn(codice, opzioni);
                
                if (societa && societa.length > 0) {
                    let html = `<h4>‚úÖ Trovate ${societa.length} societ√†</h4>`;
                    societa.forEach((s, index) => {
                        html += `
                            <div class="society-info">
                                <h4>${index + 1}. ${s.nome}</h4>
                                <p><strong>Codice:</strong> ${s.codici}</p>
                                <p><strong>Giocatori:</strong> ${s.giocatori.length}</p>
                                <p><strong>Attiva:</strong> ${s.attiva ? '‚úÖ S√¨' : '‚ùå No'}</p>
                            </div>
                        `;
                    });
                    mostraRisultato(html, 'success');
                } else {
                    mostraRisultato(`‚ùå Codice societ√† non valido o nessuna societ√† attiva trovata per: ${codice}`, 'error');
                }
                
            } catch (error) {
                console.error('Errore nella ricerca avanzata:', error);
                mostraRisultato(`‚ùå Errore durante la ricerca avanzata: ${error.message}`, 'error');
            }
        };
        
        window.eseguiEsempi = async function() {
            if (!window.esempiUtilizzoFn) {
                mostraRisultato('Modulo non ancora caricato, riprova tra un momento', 'error');
                return;
            }
            
            try {
                mostraRisultato('‚ñ∂Ô∏è Esecuzione esempi in corso... (vedi console)', 'info');
                await window.esempiUtilizzoFn();
                mostraRisultato('‚úÖ Esempi eseguiti con successo! Controlla la console del browser per i dettagli.', 'success');
            } catch (error) {
                console.error('Errore negli esempi:', error);
                mostraRisultato(`‚ùå Errore nell'esecuzione degli esempi: ${error.message}`, 'error');
            }
        };
        
        window.pulisciRisultati = function() {
            document.getElementById('risultato').style.display = 'none';
            document.getElementById('codice-societa').value = '';
        };
        
        function mostraRisultato(contenuto, tipo) {
            const risultato = document.getElementById('risultato');
            const contenutoRisultato = document.getElementById('contenuto-risultato');
            
            // Rimuovi tutte le classi di stile
            risultato.className = 'result';
            
            // Aggiungi la classe appropriata
            risultato.classList.add(tipo);
            
            // Imposta il contenuto
            contenutoRisultato.innerHTML = contenuto;
            
            // Mostra il risultato
            risultato.style.display = 'block';
            
            // Scorri verso il risultato
            risultato.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>