<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Password Population</title>
</head>
<body>
    <h1>Test Password Population</h1>
    <div id="test-results"></div>

    <script>
        // Test function to verify password population logic
        function testPasswordPopulation() {
            const testResults = document.getElementById('test-results');
            let results = [];

            // Test Case 1: Data with new config structure
            const testData1 = {
                name: "Test Society 1",
                data: {
                    config: {
                        dirigentePassword: "dirigente123",
                        misterPassword: "mister123"
                    }
                }
            };

            // Simulate the password population logic
            let currentCompanyData1 = { ...testData1 };
            if (currentCompanyData1.data && currentCompanyData1.data.config) {
                currentCompanyData1.passwords = {
                    ...(currentCompanyData1.passwords || {}),
                    dirigente: currentCompanyData1.data.config.dirigentePassword,
                    mister: currentCompanyData1.data.config.misterPassword
                };
            }

            results.push(`Test 1 - New Config Structure: ${JSON.stringify(currentCompanyData1.passwords)}`);
            results.push(`✓ dirigente password: ${currentCompanyData1.passwords.dirigente === 'dirigente123' ? 'PASS' : 'FAIL'}`);
            results.push(`✓ mister password: ${currentCompanyData1.passwords.mister === 'mister123' ? 'PASS' : 'FAIL'}`);

            // Test Case 2: Data with both old and new structure (backward compatibility)
            const testData2 = {
                name: "Test Society 2",
                passwords: {
                    marco: "old_marco_password",
                    mister: "old_mister_password"
                },
                data: {
                    config: {
                        dirigentePassword: "new_dirigente_password",
                        misterPassword: "new_mister_password"
                    }
                }
            };

            let currentCompanyData2 = { ...testData2 };
            if (currentCompanyData2.data && currentCompanyData2.data.config) {
                currentCompanyData2.passwords = {
                    ...(currentCompanyData2.passwords || {}),
                    dirigente: currentCompanyData2.data.config.dirigentePassword,
                    mister: currentCompanyData2.data.config.misterPassword
                };
            }

            results.push(`\nTest 2 - Mixed Structure: ${JSON.stringify(currentCompanyData2.passwords)}`);
            results.push(`✓ dirigente password: ${currentCompanyData2.passwords.dirigente === 'new_dirigente_password' ? 'PASS' : 'FAIL'}`);
            results.push(`✓ mister password: ${currentCompanyData2.passwords.mister === 'new_mister_password' ? 'PASS' : 'FAIL'}`);
            results.push(`✓ old marco password preserved: ${currentCompanyData2.passwords.marco === 'old_marco_password' ? 'PASS' : 'FAIL'}`);

            // Test Case 3: Data with no config (should not crash)
            const testData3 = {
                name: "Test Society 3",
                passwords: {
                    mister: "existing_mister",
                    marco: "existing_marco"
                }
            };

            let currentCompanyData3 = { ...testData3 };
            if (currentCompanyData3.data && currentCompanyData3.data.config) {
                currentCompanyData3.passwords = {
                    ...(currentCompanyData3.passwords || {}),
                    dirigente: currentCompanyData3.data.config.dirigentePassword,
                    mister: currentCompanyData3.data.config.misterPassword
                };
            }

            results.push(`\nTest 3 - No Config: ${JSON.stringify(currentCompanyData3.passwords)}`);
            results.push(`✓ old structure preserved: ${currentCompanyData3.passwords.mister === 'existing_mister' ? 'PASS' : 'FAIL'}`);

            testResults.innerHTML = '<pre>' + results.join('\n') + '</pre>';
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', testPasswordPopulation);
    </script>
</body>
</html>