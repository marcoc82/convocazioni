<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Area Polis2013 Button Visibility - V6.2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        .test-button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .yellow-button {
            background-color: #fbbf24;
            color: black;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Test Area Polis2013 Button Visibility - V6.2</h1>
    
    <div class="test-section info">
        <h2>Test Objective</h2>
        <p>Verify that the "Area Polis2013" button is correctly moved outside the <code>#admin-buttons</code> div and is visible to all users (including guests) for specific companies.</p>
        <ul>
            <li>✅ Button should be in its own container <code>#area-polis2013-container</code></li>
            <li>✅ Button should be visible for: POLIS, POLIS PIEVE 2010, PIEVE2010</li>
            <li>✅ Button should be visible to both normal users and guests</li>
            <li>✅ Button click should open <code>https://marcoc82.github.io/polis2013/</code> WITHOUT pre-filled code</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>Test Scenarios</h3>
        <button onclick="runAllTests()">Run All Tests</button>
        <div id="test-results" style="margin-top: 20px;"></div>
    </div>

    <div class="test-section">
        <h3>Visual Structure Test</h3>
        <p>Simulated button structure (as it appears in index.html):</p>
        
        <div style="border: 2px solid #ccc; padding: 15px; border-radius: 8px;">
            <div style="margin-bottom: 10px;">
                <strong>Guest Allowed Buttons (visible to all)</strong>
                <div style="background: #e0e0e0; padding: 10px; border-radius: 4px; margin-top: 5px;">
                    <button class="test-button" style="background-color: #9333ea; color: white;">Storico Convocazioni</button>
                </div>
            </div>
            
            <div style="margin-bottom: 10px;">
                <strong>Campionato Container (independent)</strong>
                <div id="test-campionato-container" style="background: #e0e0e0; padding: 10px; border-radius: 4px; margin-top: 5px;">
                    <button id="test-campionato-button" class="test-button hidden" style="background-color: #9333ea; color: white;">⚽ Campionato</button>
                </div>
            </div>
            
            <div style="margin-bottom: 10px; border: 3px solid #fbbf24; padding: 10px; border-radius: 8px;">
                <strong>✨ Area Polis2013 Container (NEW - independent)</strong>
                <div id="test-area-polis2013-container" style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 5px;">
                    <button id="test-area-polis2013-button" class="test-button yellow-button hidden">Area Polis2013</button>
                </div>
            </div>
            
            <div style="margin-bottom: 10px;">
                <strong>Admin Buttons (hidden for guests)</strong>
                <div id="test-admin-buttons" style="background: #e0e0e0; padding: 10px; border-radius: 4px; margin-top: 5px;">
                    <button class="test-button" style="background-color: #2563eb; color: white;">Gestione Squadra</button>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 15px;">
            <button onclick="simulateGuestLogin()">Simulate Guest Login</button>
            <button onclick="simulateNormalLogin()">Simulate Normal Login</button>
            <button onclick="resetSimulation()">Reset</button>
        </div>
    </div>

    <script>
        // Test functions
        function isPolisPieve2010(companyData) {
            const societa = companyData?.data;
            if (!societa) return false;
            
            const configNome = societa?.config?.nome || '';
            const nome = societa?.nome || '';
            const id = societa?.id || '';
            
            const isMatch = configNome === 'POLIS PIEVE 2010' || 
                           nome === 'POLIS PIEVE 2010' || 
                           id === 'POLIS PIEVE 2010';
            
            return isMatch;
        }
        
        function simulateButtonVisibility(companyData, isGuestLogin) {
            const companyName = companyData?.name || companyData?.data?.nome || '';
            const companyId = companyData?.data?.id || '';
            
            const isPolisPieveCompany = isPolisPieve2010(companyData);
            
            const shouldShowPolis2013Button = 
                companyName === 'POLIS' || 
                companyName === 'POLIS PIEVE 2010' || 
                companyName === 'PIEVE2010' ||
                companyId === 'POLIS' || 
                companyId === 'POLIS PIEVE 2010' || 
                companyId === 'PIEVE2010' ||
                isPolisPieveCompany;
            
            // In V6.2, admin-buttons container is hidden for guests,
            // but Area Polis2013 button is now in its own container
            const adminButtonsVisible = !isGuestLogin;
            const areaPolis2013ButtonVisible = shouldShowPolis2013Button; // Always visible if company matches
            
            return {
                adminButtonsVisible,
                areaPolis2013ButtonVisible,
                shouldShowPolis2013Button
            };
        }

        function runTest(testCase) {
            const result = simulateButtonVisibility(testCase.companyData, testCase.isGuestLogin);
            const passed = result.areaPolis2013ButtonVisible === testCase.expectedPolis2013Visible;
            
            return {
                name: testCase.name,
                expectedPolis2013Visible: testCase.expectedPolis2013Visible,
                actualPolis2013Visible: result.areaPolis2013ButtonVisible,
                passed: passed,
                details: testCase.details
            };
        }

        function runAllTests() {
            const testCases = [
                {
                    name: "Test 1: POLIS - Guest Login",
                    companyData: {
                        name: "Test Company",
                        isGuestLogin: true,
                        data: {
                            id: "POLIS",
                            nome: "POLIS"
                        }
                    },
                    isGuestLogin: true,
                    expectedPolis2013Visible: true,
                    details: "Area Polis2013 button should be visible for guest of POLIS"
                },
                {
                    name: "Test 2: POLIS PIEVE 2010 - Guest Login",
                    companyData: {
                        name: "Test Company",
                        isGuestLogin: true,
                        data: {
                            id: "some-id",
                            nome: "POLIS PIEVE 2010",
                            config: {
                                nome: "POLIS PIEVE 2010"
                            }
                        }
                    },
                    isGuestLogin: true,
                    expectedPolis2013Visible: true,
                    details: "Area Polis2013 button should be visible for guest of POLIS PIEVE 2010"
                },
                {
                    name: "Test 3: PIEVE2010 - Guest Login",
                    companyData: {
                        name: "PIEVE2010",
                        isGuestLogin: true,
                        data: {
                            id: "PIEVE2010",
                            nome: "PIEVE2010"
                        }
                    },
                    isGuestLogin: true,
                    expectedPolis2013Visible: true,
                    details: "Area Polis2013 button should be visible for guest of PIEVE2010"
                },
                {
                    name: "Test 4: Other Company - Guest Login",
                    companyData: {
                        name: "Other Company",
                        isGuestLogin: true,
                        data: {
                            id: "other-id",
                            nome: "Other Company"
                        }
                    },
                    isGuestLogin: true,
                    expectedPolis2013Visible: false,
                    details: "Area Polis2013 button should be hidden for guest of other companies"
                },
                {
                    name: "Test 5: POLIS - Normal Login",
                    companyData: {
                        name: "Test Company",
                        isGuestLogin: false,
                        data: {
                            id: "POLIS",
                            nome: "POLIS"
                        }
                    },
                    isGuestLogin: false,
                    expectedPolis2013Visible: true,
                    details: "Area Polis2013 button should be visible for normal user of POLIS"
                },
                {
                    name: "Test 6: Other Company - Normal Login",
                    companyData: {
                        name: "Other Company",
                        isGuestLogin: false,
                        data: {
                            id: "other-id",
                            nome: "Other Company"
                        }
                    },
                    isGuestLogin: false,
                    expectedPolis2013Visible: false,
                    details: "Area Polis2013 button should be hidden for normal user of other companies"
                }
            ];

            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<h4>Test Results</h4>';
            
            let passedCount = 0;
            let failedCount = 0;

            testCases.forEach(testCase => {
                const result = runTest(testCase);
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${result.passed ? 'success' : 'error'}`;
                
                let resultHTML = `
                    <strong>${result.passed ? '✅' : '❌'} ${result.name}</strong><br>
                    <em>${testCase.details}</em><br>
                    Expected Area Polis2013 visible: ${result.expectedPolis2013Visible ? 'Yes' : 'No'}<br>
                    Actual Area Polis2013 visible: ${result.actualPolis2013Visible ? 'Yes' : 'No'}
                `;
                
                resultDiv.innerHTML = resultHTML;
                resultsContainer.appendChild(resultDiv);
                
                if (result.passed) {
                    passedCount++;
                } else {
                    failedCount++;
                }
            });

            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${failedCount === 0 ? 'success' : 'error'}`;
            summaryDiv.innerHTML = `
                <strong>Summary:</strong><br>
                ✅ Passed: ${passedCount}<br>
                ${failedCount > 0 ? `❌ Failed: ${failedCount}<br>` : ''}
                <strong>${failedCount === 0 ? 'All tests passed! 🎉' : 'Some tests failed!'}</strong>
            `;
            resultsContainer.appendChild(summaryDiv);
        }

        function simulateGuestLogin() {
            document.getElementById('test-admin-buttons').style.opacity = '0.3';
            document.getElementById('test-admin-buttons').innerHTML += '<div style="color: red; font-weight: bold; margin-top: 10px;">HIDDEN FOR GUESTS</div>';
            document.getElementById('test-area-polis2013-button').classList.remove('hidden');
            document.getElementById('test-campionato-button').classList.remove('hidden');
            alert('Guest login simulated:\n✅ Area Polis2013 button is VISIBLE (in its own container)\n✅ Campionato button is VISIBLE (in its own container)\n❌ Admin buttons are HIDDEN');
        }

        function simulateNormalLogin() {
            document.getElementById('test-admin-buttons').style.opacity = '1';
            const hiddenDiv = document.getElementById('test-admin-buttons').querySelector('div[style*="color: red"]');
            if (hiddenDiv) hiddenDiv.remove();
            document.getElementById('test-area-polis2013-button').classList.remove('hidden');
            document.getElementById('test-campionato-button').classList.remove('hidden');
            alert('Normal login simulated:\n✅ Area Polis2013 button is VISIBLE\n✅ Campionato button is VISIBLE\n✅ Admin buttons are VISIBLE');
        }

        function resetSimulation() {
            document.getElementById('test-admin-buttons').style.opacity = '1';
            const hiddenDiv = document.getElementById('test-admin-buttons').querySelector('div[style*="color: red"]');
            if (hiddenDiv) hiddenDiv.remove();
            document.getElementById('test-area-polis2013-button').classList.add('hidden');
            document.getElementById('test-campionato-button').classList.add('hidden');
        }

        // Test URL building without pre-filled code
        function testURLBuilding() {
            const companies = [
                { name: 'POLIS', expectedCode: 'POLIS2013' },
                { name: 'POLIS PIEVE 2010', expectedCode: 'PIEVE2010' },
                { name: 'PIEVE2010', expectedCode: 'PIEVE2010' }
            ];

            console.log('=== Testing URL Building (V6.2 - No pre-filled code) ===');
            companies.forEach(company => {
                const url = 'https://marcoc82.github.io/polis2013/';
                console.log(`Company: ${company.name}`);
                console.log(`  URL opened: ${url}`);
                console.log(`  ℹ️ User should manually enter: ${company.expectedCode}`);
                console.log(`  ✅ No code pre-filled in URL`);
            });
        }

        // Run URL test on load
        window.addEventListener('load', () => {
            testURLBuilding();
        });
    </script>
</body>
</html>
