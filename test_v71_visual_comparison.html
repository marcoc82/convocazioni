<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Comparison: V7.0 vs V7.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .comparison-box {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .old-version {
            background: linear-gradient(to bottom, #fef2f2, #ffffff);
            border-color: #fca5a5;
        }
        .new-version {
            background: linear-gradient(to bottom, #f0fdf4, #ffffff);
            border-color: #86efac;
        }
        .badge-old {
            background: #dc2626;
            color: white;
        }
        .badge-new {
            background: #16a34a;
            color: white;
        }
        .match-fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .match-success {
            background: #dcfce7;
            color: #166534;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">V7.0 → V7.1 Comparison</h1>
            <p class="text-lg text-gray-600">% Disponibilità Column - Matching Improvements</p>
        </div>

        <!-- Side by Side Comparison -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- V7.0 (Old) -->
            <div class="comparison-box old-version">
                <div class="text-center mb-4">
                    <span class="inline-block px-4 py-2 rounded-full font-bold badge-old">V 7.0 - OLD</span>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-4">❌ Issues in V7.0</h3>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left p-2">Player</th>
                                <th class="text-center p-2">% Disp.</th>
                                <th class="text-center p-2">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="p-2">1 ROSSI MARIO</td>
                                <td class="text-center p-2">85.0%</td>
                                <td class="text-center p-2">✅ OK</td>
                            </tr>
                            <tr class="border-b match-fail">
                                <td class="p-2">2 BIANCHI LUIGI</td>
                                <td class="text-center p-2 font-bold">N/D</td>
                                <td class="text-center p-2 text-xs">❌ Shows N/D for 0</td>
                            </tr>
                            <tr class="border-b match-fail">
                                <td class="p-2">3 VERDI GIUSEPPE</td>
                                <td class="text-center p-2 font-bold">N/D</td>
                                <td class="text-center p-2 text-xs">❌ Extra spaces</td>
                            </tr>
                            <tr class="border-b match-fail">
                                <td class="p-2">4 NERI ANTONIO</td>
                                <td class="text-center p-2 font-bold">N/D</td>
                                <td class="text-center p-2 text-xs">❌ Case sensitive</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-2">5 GIALLI FRANCESCO</td>
                                <td class="text-center p-2">100.0%</td>
                                <td class="text-center p-2">✅ OK</td>
                            </tr>
                            <tr class="border-b match-fail">
                                <td class="p-2">6 BLU MARCO</td>
                                <td class="text-center p-2 font-bold">N/D</td>
                                <td class="text-center p-2 text-xs">❌ Accent (BLÙ)</td>
                            </tr>
                            <tr>
                                <td class="p-2">7 VIOLA STEFANO</td>
                                <td class="text-center p-2">N/D</td>
                                <td class="text-center p-2">✅ OK (missing)</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mt-4 p-3 bg-red-50 rounded text-sm">
                        <p class="font-semibold text-red-800 mb-1">Problems:</p>
                        <ul class="list-disc list-inside text-red-700 text-xs">
                            <li>Case-sensitive matching only</li>
                            <li>No space normalization</li>
                            <li>No accent removal</li>
                            <li>Shows "N/D" for zero values</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- V7.1 (New) -->
            <div class="comparison-box new-version">
                <div class="text-center mb-4">
                    <span class="inline-block px-4 py-2 rounded-full font-bold badge-new">V 7.1 - NEW</span>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-4">✅ Fixed in V7.1</h3>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left p-2">Player</th>
                                <th class="text-center p-2">% Disp.</th>
                                <th class="text-center p-2">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b match-success">
                                <td class="p-2">1 ROSSI MARIO</td>
                                <td class="text-center p-2 font-bold">85.0%</td>
                                <td class="text-center p-2 text-xs">✅ Exact match</td>
                            </tr>
                            <tr class="border-b match-success">
                                <td class="p-2">2 BIANCHI LUIGI</td>
                                <td class="text-center p-2 font-bold">0.0%</td>
                                <td class="text-center p-2 text-xs">✅ Shows 0%</td>
                            </tr>
                            <tr class="border-b match-success">
                                <td class="p-2">3 VERDI GIUSEPPE</td>
                                <td class="text-center p-2 font-bold">75.0%</td>
                                <td class="text-center p-2 text-xs">✅ Space normalized</td>
                            </tr>
                            <tr class="border-b match-success">
                                <td class="p-2">4 NERI ANTONIO</td>
                                <td class="text-center p-2 font-bold">62.0%</td>
                                <td class="text-center p-2 text-xs">✅ Case insensitive</td>
                            </tr>
                            <tr class="border-b match-success">
                                <td class="p-2">5 GIALLI FRANCESCO</td>
                                <td class="text-center p-2 font-bold">100.0%</td>
                                <td class="text-center p-2 text-xs">✅ Mixed case</td>
                            </tr>
                            <tr class="border-b match-success">
                                <td class="p-2">6 BLU MARCO</td>
                                <td class="text-center p-2 font-bold">45.0%</td>
                                <td class="text-center p-2 text-xs">✅ Accent removed</td>
                            </tr>
                            <tr>
                                <td class="p-2">7 VIOLA STEFANO</td>
                                <td class="text-center p-2">N/D</td>
                                <td class="text-center p-2 text-xs">✅ Missing (correct)</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="mt-4 p-3 bg-green-50 rounded text-sm">
                        <p class="font-semibold text-green-800 mb-1">Improvements:</p>
                        <ul class="list-disc list-inside text-green-700 text-xs">
                            <li>✅ Case-insensitive matching</li>
                            <li>✅ Space trimming and collapsing</li>
                            <li>✅ Accent/special char removal</li>
                            <li>✅ Proper zero value display (0%)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Matching Logic Comparison -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Matching Logic Comparison</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-red-700 mb-3">V7.0 Logic (Exact Match Only)</h3>
                    <pre class="bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-x-auto"><code>// Direct lookup - no fuzzy matching
if (isPolisCompany && 
    availabilityData[player.name] !== undefined) {
    const rawValue = availabilityData[player.name];
    // Process value...
}

// Problems:
// ❌ "ROSSI" ≠ "rossi"
// ❌ "VERDI  GIUSEPPE" ≠ "VERDI GIUSEPPE"
// ❌ "BLÙ" ≠ "BLU"
// ❌ 0 shows as "N/D"</code></pre>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-green-700 mb-3">V7.1 Logic (Fuzzy Match)</h3>
                    <pre class="bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-x-auto"><code>// Helper function for normalization
const normalizePlayerName = (name) => {
    return name
        .toLowerCase()
        .trim()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-z0-9\s]/gi, '')
        .replace(/\s+/g, ' ');
};

// Try exact match, then normalized
let rawValue = availabilityData[player.name];
if (rawValue === undefined) {
    const normalized = normalizePlayerName(player.name);
    rawValue = availabilityDataNormalized[normalized];
}

// Proper zero handling
if (rawValue !== undefined && rawValue !== null) {
    // Process value... (0 shows as "0.0%")
}

// Benefits:
// ✅ "ROSSI" = "rossi"
// ✅ "VERDI  GIUSEPPE" = "VERDI GIUSEPPE"
// ✅ "BLÙ" = "BLU"
// ✅ 0 shows as "0.0%"</code></pre>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Impact Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-4xl font-bold text-red-600 mb-2">3/7</div>
                    <div class="text-sm text-gray-600">V7.0 Success Rate</div>
                    <div class="text-xs text-gray-500 mt-1">(42.9% match rate)</div>
                </div>
                <div class="text-center">
                    <div class="text-5xl font-bold text-green-600 mb-2">→</div>
                    <div class="text-sm font-semibold text-gray-700">Improvement</div>
                </div>
                <div class="text-center">
                    <div class="text-4xl font-bold text-green-600 mb-2">7/7</div>
                    <div class="text-sm text-gray-600">V7.1 Success Rate</div>
                    <div class="text-xs text-gray-500 mt-1">(100% match rate) ✅</div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <p class="text-lg font-semibold text-gray-800">
                    <span class="text-green-600">+57.1%</span> improvement in match accuracy
                </p>
            </div>
        </div>

        <!-- Firebase Data Example -->
        <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Example Firebase Data</h2>
            <p class="text-sm text-gray-600 mb-4">Shows how messy real-world data is handled:</p>
            <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>{
  "1 ROSSI MARIO": 0.85,        // ✅ Clean data - exact match
  "2 bianchi luigi": 0.0,       // ⚠️ Lowercase, zero value
  "3 VERDI  GIUSEPPE": 75,      // ⚠️ Extra space, percentage format
  "4 neri  ANTONIO ": 0.62,     // ⚠️ Mixed case, spaces, trailing space
  "5 Gialli Francesco": 1.0,    // ⚠️ Mixed case, decimal format
  "6 BLÙ Marco": 0.45          // ⚠️ Accent character
}</code></pre>
            <p class="text-xs text-gray-500 mt-2">V7.1 successfully matches all these variations!</p>
        </div>
    </div>

    <script>
        console.log('✅ V7.1 Visual Comparison loaded');
        console.log('📊 Demonstrates improvements in name matching and zero value display');
    </script>
</body>
</html>
