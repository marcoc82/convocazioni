<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test V8.9 - Auto-refresh Report & Collapsed Cards</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üß™ Test V8.9 - New Features</h1>
            <p class="text-gray-600 mb-4">Verifica le nuove funzionalit√† V8.9</p>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <h2 class="text-lg font-semibold mb-2">üìã Requisiti V8.9</h2>
                <ul class="list-disc list-inside text-sm space-y-1">
                    <li><strong>Requisito 1:</strong> Il report presenze si carica automaticamente all'apertura della pagina (gi√† presente in V8.8)</li>
                    <li><strong>Requisito 2:</strong> Quando salvo una nuova sessione, il report presenze si aggiorna automaticamente (NUOVO)</li>
                    <li><strong>Requisito 3:</strong> Quando una sessione √® chiusa, mostra "Presenti: X, Assenti: Y" sotto la data (NUOVO)</li>
                    <li>Tutte le funzionalit√† V8.8 mantenute</li>
                </ul>
            </div>
        </div>

        <!-- Report Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="bg-blue-50 rounded-xl p-4 shadow-sm border border-blue-200">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">üìä Report Presenze</h3>
                <div class="bg-gray-50 rounded p-3 text-sm">
                    <p class="font-semibold mb-1">Test Status:</p>
                    <p id="report-status" class="text-gray-700">Report should auto-load on page open</p>
                </div>
            </div>
        </div>

        <!-- Sample Collapsible Cards Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">üìÖ Sessioni Allenamento</h3>
            <p class="text-sm text-gray-600 mb-4">Le card mostrano "Presenti: X, Assenti: Y" quando sono chiuse</p>
            
            <!-- Sample Card 1 - Collapsed (default) -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-4">
                <!-- Card Header (always visible, clickable) -->
                <div class="card-header p-4 cursor-pointer hover:bg-gray-50 rounded-xl transition-colors" onclick="toggleCard(this)">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-800">üìÖ Venerd√¨ 20 dicembre 2024</h4>
                            <!-- V8.9: Show present/absent count when collapsed -->
                            <div class="attendance-summary text-sm mt-1">
                                <span class="text-green-600 font-semibold">Presenti: 12</span>
                                <span class="ml-3 text-red-600 font-semibold">Assenti: 3</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="expand-icon w-6 h-6 text-gray-600 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Card Content (collapsible) -->
                <div class="card-content hidden p-4 pt-0">
                    <p class="text-sm text-gray-600 mb-3">üïê Orario: 19:00</p>
                    
                    <div class="mb-3 space-y-2">
                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <span class="text-sm text-gray-700">10 ROSSI MARIO</span>
                            <input type="checkbox" checked class="w-5 h-5 text-teal-600 rounded">
                        </label>
                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <span class="text-sm text-gray-700">7 BIANCHI LUIGI</span>
                            <input type="checkbox" checked class="w-5 h-5 text-teal-600 rounded">
                        </label>
                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <span class="text-sm text-gray-700">23 VERDI GIUSEPPE</span>
                            <input type="checkbox" class="w-5 h-5 text-teal-600 rounded">
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center mb-3 p-3 bg-gray-50 rounded">
                        <div class="text-sm">
                            <span class="text-green-600 font-semibold">‚úì Presenti: 12</span>
                            <span class="ml-3 text-red-600 font-semibold">‚úó Assenti: 3</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="flex-1 bg-green-500 hover:bg-green-600 text-white text-sm py-2 rounded font-medium">
                            Tutti Presenti
                        </button>
                        <button class="flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 rounded font-medium">
                            Tutti Assenti
                        </button>
                        <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 rounded font-medium">
                            üíæ Salva
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sample Card 2 - Collapsed -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-4">
                <!-- Card Header (always visible, clickable) -->
                <div class="card-header p-4 cursor-pointer hover:bg-gray-50 rounded-xl transition-colors" onclick="toggleCard(this)">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-800">üìÖ Mercoled√¨ 18 dicembre 2024</h4>
                            <!-- V8.9: Show present/absent count when collapsed -->
                            <div class="attendance-summary text-sm mt-1">
                                <span class="text-green-600 font-semibold">Presenti: 14</span>
                                <span class="ml-3 text-red-600 font-semibold">Assenti: 1</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg class="expand-icon w-6 h-6 text-gray-600 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Card Content (collapsible) -->
                <div class="card-content hidden p-4 pt-0">
                    <p class="text-sm text-gray-600 mb-3">üïê Orario: 18:30</p>
                    
                    <div class="mb-3 space-y-2">
                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <span class="text-sm text-gray-700">10 ROSSI MARIO</span>
                            <input type="checkbox" checked class="w-5 h-5 text-teal-600 rounded">
                        </label>
                        <label class="flex items-center justify-between p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <span class="text-sm text-gray-700">7 BIANCHI LUIGI</span>
                            <input type="checkbox" checked class="w-5 h-5 text-teal-600 rounded">
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center mb-3 p-3 bg-gray-50 rounded">
                        <div class="text-sm">
                            <span class="text-green-600 font-semibold">‚úì Presenti: 14</span>
                            <span class="ml-3 text-red-600 font-semibold">‚úó Assenti: 1</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="flex-1 bg-green-500 hover:bg-green-600 text-white text-sm py-2 rounded font-medium">
                            Tutti Presenti
                        </button>
                        <button class="flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 rounded font-medium">
                            Tutti Assenti
                        </button>
                        <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 rounded font-medium">
                            üíæ Salva
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
                <h3 class="font-semibold text-green-800 mb-2">‚úÖ Test Instructions:</h3>
                <ol class="list-decimal list-inside text-sm space-y-1 text-green-800">
                    <li>Click on the card headers to expand/collapse them</li>
                    <li>Notice that when collapsed, "Presenti: X, Assenti: Y" is visible</li>
                    <li>Notice that when expanded, the count is hidden (shown only inside)</li>
                    <li>Only one card can be expanded at a time (accordion behavior)</li>
                </ol>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-3">‚úÖ Test Checklist V8.9</h2>
            <div class="space-y-2 text-sm">
                <div class="p-3 bg-green-50 border border-green-200 rounded">
                    <strong>‚úÖ Test 1:</strong> Report presenze si carica automaticamente all'apertura (gi√† presente in V8.8)
                </div>
                <div class="p-3 bg-green-50 border border-green-200 rounded">
                    <strong>‚úÖ Test 2:</strong> Quando salvo una nuova sessione, il report si aggiorna automaticamente
                    <p class="text-xs text-gray-600 mt-1">Implementato: loadAllenamentiReport() chiamata dopo saveNewTrainingSession()</p>
                </div>
                <div class="p-3 bg-green-50 border border-green-200 rounded">
                    <strong>‚úÖ Test 3:</strong> Card chiusa mostra "Presenti: X, Assenti: Y" sotto la data
                    <p class="text-xs text-gray-600 mt-1">Verifica visivamente le card di esempio sopra</p>
                </div>
                <div class="p-3 bg-blue-50 border border-blue-200 rounded">
                    <strong>üìù Note:</strong> Tutte le funzionalit√† precedenti (V8.8) sono mantenute
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <h2 class="text-xl font-semibold mb-3">üìã Change Summary V8.9</h2>
            <div class="space-y-3 text-sm">
                <div class="border-l-4 border-green-500 pl-4 py-2">
                    <strong class="text-green-700">FEATURE 1:</strong> Auto-refresh report presenze after saving new session
                    <p class="text-gray-600 mt-1">Location: index.html line ~5432 (saveNewTrainingSession function)</p>
                    <code class="text-xs bg-gray-100 px-2 py-1 rounded mt-1 block">loadAllenamentiReport(); // Auto-refresh report after saving new session</code>
                </div>
                
                <div class="border-l-4 border-green-500 pl-4 py-2">
                    <strong class="text-green-700">FEATURE 2:</strong> Show "Presenti: X, Assenti: Y" on collapsed cards
                    <p class="text-gray-600 mt-1">Location: index.html line ~5222 (createTrainingSessionCard function)</p>
                    <code class="text-xs bg-gray-100 px-2 py-1 rounded mt-1 block">&lt;div class="attendance-summary text-sm mt-1 ${expandByDefault ? 'hidden' : ''}"&gt;</code>
                </div>
                
                <div class="border-l-4 border-blue-500 pl-4 py-2">
                    <strong class="text-blue-700">VERSION:</strong> Updated to V8.9
                    <p class="text-gray-600 mt-1">Updated in: index.html (line 2), manifest.json (line 4), and all relevant comments/logs</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle card expansion/collapse with accordion behavior
        function toggleCard(cardHeader) {
            const card = cardHeader.closest('.bg-white');
            const cardContent = card.querySelector('.card-content');
            const expandIcon = card.querySelector('.expand-icon');
            const attendanceSummary = card.querySelector('.attendance-summary');
            
            const isExpanded = !cardContent.classList.contains('hidden');
            
            if (isExpanded) {
                // Collapse this card
                cardContent.classList.add('hidden');
                expandIcon.classList.remove('rotate-180');
                // Show attendance summary when collapsed
                if (attendanceSummary) {
                    attendanceSummary.classList.remove('hidden');
                }
            } else {
                // Collapse all other cards first (accordion behavior)
                const allCards = document.querySelectorAll('.bg-white.rounded-xl.shadow-sm');
                allCards.forEach(otherCard => {
                    if (otherCard !== card) {
                        const otherContent = otherCard.querySelector('.card-content');
                        const otherIcon = otherCard.querySelector('.expand-icon');
                        const otherSummary = otherCard.querySelector('.attendance-summary');
                        if (otherContent && !otherContent.classList.contains('hidden')) {
                            otherContent.classList.add('hidden');
                            otherIcon.classList.remove('rotate-180');
                            // Show attendance summary on other cards when they collapse
                            if (otherSummary) {
                                otherSummary.classList.remove('hidden');
                            }
                        }
                    }
                });
                
                // Expand this card
                cardContent.classList.remove('hidden');
                expandIcon.classList.add('rotate-180');
                // Hide attendance summary when expanded
                if (attendanceSummary) {
                    attendanceSummary.classList.add('hidden');
                }
            }
        }

        // Run on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Test V8.9 loaded');
            document.getElementById('report-status').textContent = '‚úÖ Page loaded - Report should auto-load (already working in V8.8)';
        });
    </script>
</body>
</html>
